#############################################
# OpenMPI compiler wrapper
#############################################
CXX = mpicxx


#############################################
# Library directories -> ADJUST!
#############################################
LDFLAGS = -L/path/to/sundials/instdir/lib


#############################################
# Include directories -> ADJUST!
#############################################
IDFLAGS = -I/path/to/sundials/instdir/include


#############################################
# Compiler options
#############################################
CXXFLAGS  = -std=c++20 -O2 $(IDFLAGS)


#############################################
# Overal target, files, headers, libraries
#############################################
TARGET = Simulation
CLASS_FILES = SimulationFunctions.cpp \
			  LatticePatch.cpp \
			  DerivationStencils.cpp \
			  SimulationClass.cpp \
			  TimeEvolutionFunctions.cpp \
			  ICSetters.cpp \
			  Outputters.cpp

CLASS_HEADERS = $(CLASS_FILES:.cpp=.h)

SOURCE = main.cpp $(CLASS_FILES)
HEADER = Masterheader.h \
		 $(CLASS_HEADER)

# Used libraries
LIBS = -lsundials_cvode \
	   -lsundials_nvecmpiplusx \
	   -lsundials_nvecopenmp


##########################################################
# Targets and recipes for compilation and linking, cleanup
##########################################################

all: $(TARGET)

################################################################
OBJECTS = $(SOURCE:.cpp=.o)
$(OBJECTS): $(SOURCE)
	$(CXX) -c $(CXXFLAGS) $(SOURCE)

$(TARGET): $(OBJECTS)
	$(CXX) $(CXXFLAGS) $(LDFLAGS) -o $(TARGET) $(OBJECTS) $(LIBS)
################################################################


# Clean up
.PHONY : clean
clean:
	$(RM) *.o $(TARGET)
